{"version":3,"file":"resource-loader.js","sources":["../src/async.js","../src/middleware/caching.js","../node_modules/parse-uri/index.js","../node_modules/mini-signals/lib/mini-signals.js","../src/Resource.js","../src/encodeBinary.js","../src/middleware/parsing.js","../src/middleware/index.js","../src/Loader.js","../src/bundle.js"],"sourcesContent":["/**\n * Smaller version of the async library constructs.\n *\n * @namespace async\n */\n\n/**\n * Noop function\n *\n * @ignore\n * @function\n * @memberof async\n */\nfunction _noop() { /* empty */ }\n\n/**\n * Iterates an array in series.\n *\n * @memberof async\n * @function eachSeries\n * @param {Array.<*>} array - Array to iterate.\n * @param {function} iterator - Function to call for each element.\n * @param {function} callback - Function to call when done, or on error.\n * @param {boolean} [deferNext=false] - Break synchronous each loop by calling next with a setTimeout of 1.\n */\nexport function eachSeries(array, iterator, callback, deferNext) {\n    let i = 0;\n    const len = array.length;\n\n    (function next(err) {\n        if (err || i === len) {\n            if (callback) {\n                callback(err);\n            }\n\n            return;\n        }\n\n        if (deferNext) {\n            setTimeout(() => {\n                iterator(array[i++], next);\n            }, 1);\n        }\n        else {\n            iterator(array[i++], next);\n        }\n    })();\n}\n\n/**\n * Ensures a function is only called once.\n *\n * @ignore\n * @memberof async\n * @param {function} fn - The function to wrap.\n * @return {function} The wrapping function.\n */\nfunction onlyOnce(fn) {\n    return function onceWrapper() {\n        if (fn === null) {\n            throw new Error('Callback was already called.');\n        }\n\n        const callFn = fn;\n\n        fn = null;\n        callFn.apply(this, arguments);\n    };\n}\n\n/**\n * Async queue implementation,\n *\n * @memberof async\n * @function queue\n * @param {function} worker - The worker function to call for each task.\n * @param {number} concurrency - How many workers to run in parrallel.\n * @return {*} The async queue object.\n */\nexport function queue(worker, concurrency) {\n    if (concurrency == null) { // eslint-disable-line no-eq-null,eqeqeq\n        concurrency = 1;\n    }\n    else if (concurrency === 0) {\n        throw new Error('Concurrency must not be zero');\n    }\n\n    let workers = 0;\n    const q = {\n        _tasks: [],\n        concurrency,\n        saturated: _noop,\n        unsaturated: _noop,\n        buffer: concurrency / 4,\n        empty: _noop,\n        drain: _noop,\n        error: _noop,\n        started: false,\n        paused: false,\n        push(data, callback) {\n            _insert(data, false, callback);\n        },\n        kill() {\n            workers = 0;\n            q.drain = _noop;\n            q.started = false;\n            q._tasks = [];\n        },\n        unshift(data, callback) {\n            _insert(data, true, callback);\n        },\n        process() {\n            while (!q.paused && workers < q.concurrency && q._tasks.length) {\n                const task = q._tasks.shift();\n\n                if (q._tasks.length === 0) {\n                    q.empty();\n                }\n\n                workers += 1;\n\n                if (workers === q.concurrency) {\n                    q.saturated();\n                }\n\n                worker(task.data, onlyOnce(_next(task)));\n            }\n        },\n        length() {\n            return q._tasks.length;\n        },\n        running() {\n            return workers;\n        },\n        idle() {\n            return q._tasks.length + workers === 0;\n        },\n        pause() {\n            if (q.paused === true) {\n                return;\n            }\n\n            q.paused = true;\n        },\n        resume() {\n            if (q.paused === false) {\n                return;\n            }\n\n            q.paused = false;\n\n            // Need to call q.process once per concurrent\n            // worker to preserve full concurrency after pause\n            for (let w = 1; w <= q.concurrency; w++) {\n                q.process();\n            }\n        },\n    };\n\n    function _insert(data, insertAtFront, callback) {\n        if (callback != null && typeof callback !== 'function') { // eslint-disable-line no-eq-null,eqeqeq\n            throw new Error('task callback must be a function');\n        }\n\n        q.started = true;\n\n        if (data == null && q.idle()) { // eslint-disable-line no-eq-null,eqeqeq\n            // call drain immediately if there are no tasks\n            setTimeout(() => q.drain(), 1);\n\n            return;\n        }\n\n        const item = {\n            data,\n            callback: typeof callback === 'function' ? callback : _noop,\n        };\n\n        if (insertAtFront) {\n            q._tasks.unshift(item);\n        }\n        else {\n            q._tasks.push(item);\n        }\n\n        setTimeout(() => q.process(), 1);\n    }\n\n    function _next(task) {\n        return function next() {\n            workers -= 1;\n\n            task.callback.apply(task, arguments);\n\n            if (arguments[0] != null) { // eslint-disable-line no-eq-null,eqeqeq\n                q.error(arguments[0], task.data);\n            }\n\n            if (workers <= (q.concurrency - q.buffer)) {\n                q.unsaturated();\n            }\n\n            if (q.idle()) {\n                q.drain();\n            }\n\n            q.process();\n        };\n    }\n\n    return q;\n}\n","// a simple in-memory cache for resources\nconst cache = {};\n\n/**\n * A simple in-memory cache for resource.\n *\n * @memberof middleware\n * @function caching\n * @example\n * import { Loader, middleware } from 'resource-loader';\n * const loader = new Loader();\n * loader.use(middleware.caching);\n * @param {Resource} resource - Current Resource\n * @param {function} next - Callback when complete\n */\nexport function caching(resource, next) {\n    // if cached, then set data and complete the resource\n    if (cache[resource.url]) {\n        resource.data = cache[resource.url];\n        resource.complete(); // marks resource load complete and stops processing before middlewares\n    }\n    // if not cached, wait for complete and store it in the cache.\n    else {\n        resource.onComplete.once(() => (cache[this.url] = this.data));\n    }\n\n    next();\n}\n","'use strict'\n\nmodule.exports = function parseURI (str, opts) {\n  opts = opts || {}\n\n  var o = {\n    key: ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'],\n    q: {\n      name: 'queryKey',\n      parser: /(?:^|&)([^&=]*)=?([^&]*)/g\n    },\n    parser: {\n      strict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      loose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n    }\n  }\n\n  var m = o.parser[opts.strictMode ? 'strict' : 'loose'].exec(str)\n  var uri = {}\n  var i = 14\n\n  while (i--) uri[o.key[i]] = m[i] || ''\n\n  uri[o.q.name] = {}\n  uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {\n    if ($1) uri[o.q.name][$1] = $2\n  })\n\n  return uri\n}\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nvar MiniSignalBinding = (function () {\n  function MiniSignalBinding(fn, once, thisArg) {\n    if (once === undefined) once = false;\n\n    _classCallCheck(this, MiniSignalBinding);\n\n    this._fn = fn;\n    this._once = once;\n    this._thisArg = thisArg;\n    this._next = this._prev = this._owner = null;\n  }\n\n  _createClass(MiniSignalBinding, [{\n    key: 'detach',\n    value: function detach() {\n      if (this._owner === null) return false;\n      this._owner.detach(this);\n      return true;\n    }\n  }]);\n\n  return MiniSignalBinding;\n})();\n\nfunction _addMiniSignalBinding(self, node) {\n  if (!self._head) {\n    self._head = node;\n    self._tail = node;\n  } else {\n    self._tail._next = node;\n    node._prev = self._tail;\n    self._tail = node;\n  }\n\n  node._owner = self;\n\n  return node;\n}\n\nvar MiniSignal = (function () {\n  function MiniSignal() {\n    _classCallCheck(this, MiniSignal);\n\n    this._head = this._tail = undefined;\n  }\n\n  _createClass(MiniSignal, [{\n    key: 'handlers',\n    value: function handlers() {\n      var exists = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];\n\n      var node = this._head;\n\n      if (exists) return !!node;\n\n      var ee = [];\n\n      while (node) {\n        ee.push(node);\n        node = node._next;\n      }\n\n      return ee;\n    }\n  }, {\n    key: 'has',\n    value: function has(node) {\n      if (!(node instanceof MiniSignalBinding)) {\n        throw new Error('MiniSignal#has(): First arg must be a MiniSignalBinding object.');\n      }\n\n      return node._owner === this;\n    }\n  }, {\n    key: 'dispatch',\n    value: function dispatch() {\n      var node = this._head;\n\n      if (!node) return false;\n\n      while (node) {\n        if (node._once) this.detach(node);\n        node._fn.apply(node._thisArg, arguments);\n        node = node._next;\n      }\n\n      return true;\n    }\n  }, {\n    key: 'add',\n    value: function add(fn) {\n      var thisArg = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];\n\n      if (typeof fn !== 'function') {\n        throw new Error('MiniSignal#add(): First arg must be a Function.');\n      }\n      return _addMiniSignalBinding(this, new MiniSignalBinding(fn, false, thisArg));\n    }\n  }, {\n    key: 'once',\n    value: function once(fn) {\n      var thisArg = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];\n\n      if (typeof fn !== 'function') {\n        throw new Error('MiniSignal#once(): First arg must be a Function.');\n      }\n      return _addMiniSignalBinding(this, new MiniSignalBinding(fn, true, thisArg));\n    }\n  }, {\n    key: 'detach',\n    value: function detach(node) {\n      if (!(node instanceof MiniSignalBinding)) {\n        throw new Error('MiniSignal#detach(): First arg must be a MiniSignalBinding object.');\n      }\n      if (node._owner !== this) return this;\n\n      if (node._prev) node._prev._next = node._next;\n      if (node._next) node._next._prev = node._prev;\n\n      if (node === this._head) {\n        this._head = node._next;\n        if (node._next === null) {\n          this._tail = null;\n        }\n      } else if (node === this._tail) {\n        this._tail = node._prev;\n        this._tail._next = null;\n      }\n\n      node._owner = null;\n      return this;\n    }\n  }, {\n    key: 'detachAll',\n    value: function detachAll() {\n      var node = this._head;\n      if (!node) return this;\n\n      this._head = this._tail = null;\n\n      while (node) {\n        node._owner = null;\n        node = node._next;\n      }\n      return this;\n    }\n  }]);\n\n  return MiniSignal;\n})();\n\nMiniSignal.MiniSignalBinding = MiniSignalBinding;\n\nexports['default'] = MiniSignal;\nmodule.exports = exports['default'];\n","import parseUri from 'parse-uri';\nimport Signal from 'mini-signals';\n\n// tests if CORS is supported in XHR, if not we need to use XDR\nconst useXdr = !!(window.XDomainRequest && !('withCredentials' in (new XMLHttpRequest())));\nlet tempAnchor = null;\n\n// some status constants\nconst STATUS_NONE = 0;\nconst STATUS_OK = 200;\nconst STATUS_EMPTY = 204;\nconst STATUS_IE_BUG_EMPTY = 1223;\nconst STATUS_TYPE_OK = 2;\n\n// noop\nfunction _noop() { /* empty */ }\n\n/**\n * Manages the state and loading of a resource and all child resources.\n *\n * @class\n */\nclass Resource {\n    /**\n     * Sets the load type to be used for a specific extension.\n     *\n     * @static\n     * @param {string} extname - The extension to set the type for, e.g. \"png\" or \"fnt\"\n     * @param {Resource.LOAD_TYPE} loadType - The load type to set it to.\n     */\n    static setExtensionLoadType(extname, loadType) {\n        setExtMap(Resource._loadTypeMap, extname, loadType);\n    }\n\n    /**\n     * Sets the load type to be used for a specific extension.\n     *\n     * @static\n     * @param {string} extname - The extension to set the type for, e.g. \"png\" or \"fnt\"\n     * @param {Resource.XHR_RESPONSE_TYPE} xhrType - The xhr type to set it to.\n     */\n    static setExtensionXhrType(extname, xhrType) {\n        setExtMap(Resource._xhrTypeMap, extname, xhrType);\n    }\n\n    /**\n     * @param {string} name - The name of the resource to load.\n     * @param {string|string[]} url - The url for this resource, for audio/video loads you can pass\n     *      an array of sources.\n     * @param {object} [options] - The options for the load.\n     * @param {string|boolean} [options.crossOrigin] - Is this request cross-origin? Default is to\n     *      determine automatically.\n     * @param {number} [options.timeout=0] - A timeout in milliseconds for the load. If the load takes\n     *      longer than this time it is cancelled and the load is considered a failure. If this value is\n     *      set to `0` then there is no explicit timeout.\n     * @param {Resource.LOAD_TYPE} [options.loadType=Resource.LOAD_TYPE.XHR] - How should this resource\n     *      be loaded?\n     * @param {Resource.XHR_RESPONSE_TYPE} [options.xhrType=Resource.XHR_RESPONSE_TYPE.DEFAULT] - How\n     *      should the data being loaded be interpreted when using XHR?\n     * @param {Resource.IMetadata} [options.metadata] - Extra configuration for middleware and the Resource object.\n     */\n    constructor(name, url, options) {\n        if (typeof name !== 'string' || typeof url !== 'string') {\n            throw new Error('Both name and url are required for constructing a resource.');\n        }\n\n        options = options || {};\n\n        /**\n         * The state flags of this resource.\n         *\n         * @private\n         * @member {number}\n         */\n        this._flags = 0;\n\n        // set data url flag, needs to be set early for some _determineX checks to work.\n        this._setFlag(Resource.STATUS_FLAGS.DATA_URL, url.indexOf('data:') === 0);\n\n        /**\n         * The name of this resource.\n         *\n         * @readonly\n         * @member {string}\n         */\n        this.name = name;\n\n        /**\n         * The url used to load this resource.\n         *\n         * @readonly\n         * @member {string}\n         */\n        this.url = url;\n\n        /**\n         * The extension used to load this resource.\n         *\n         * @readonly\n         * @member {string}\n         */\n        this.extension = this._getExtension();\n\n        /**\n         * The data that was loaded by the resource.\n         *\n         * @member {any}\n         */\n        this.data = null;\n\n        /**\n         * Is this request cross-origin? If unset, determined automatically.\n         *\n         * @member {string}\n         */\n        this.crossOrigin = options.crossOrigin === true ? 'anonymous' : options.crossOrigin;\n\n        /**\n         * A timeout in milliseconds for the load. If the load takes longer than this time\n         * it is cancelled and the load is considered a failure. If this value is set to `0`\n         * then there is no explicit timeout.\n         *\n         * @member {number}\n         */\n        this.timeout = options.timeout || 0;\n\n        /**\n         * The method of loading to use for this resource.\n         *\n         * @member {Resource.LOAD_TYPE}\n         */\n        this.loadType = options.loadType || this._determineLoadType();\n\n        /**\n         * The type used to load the resource via XHR. If unset, determined automatically.\n         *\n         * @member {string}\n         */\n        this.xhrType = options.xhrType;\n\n        /**\n         * Extra info for middleware, and controlling specifics about how the resource loads.\n         *\n         * Note that if you pass in a `loadElement`, the Resource class takes ownership of it.\n         * Meaning it will modify it as it sees fit.\n         *\n         * @member {Resource.IMetadata}\n         */\n        this.metadata = options.metadata || {};\n\n        /**\n         * The error that occurred while loading (if any).\n         *\n         * @readonly\n         * @member {Error}\n         */\n        this.error = null;\n\n        /**\n         * The XHR object that was used to load this resource. This is only set\n         * when `loadType` is `Resource.LOAD_TYPE.XHR`.\n         *\n         * @readonly\n         * @member {XMLHttpRequest}\n         */\n        this.xhr = null;\n\n        /**\n         * The child resources this resource owns.\n         *\n         * @readonly\n         * @member {Resource[]}\n         */\n        this.children = [];\n\n        /**\n         * The resource type.\n         *\n         * @readonly\n         * @member {Resource.TYPE}\n         */\n        this.type = Resource.TYPE.UNKNOWN;\n\n        /**\n         * The progress chunk owned by this resource.\n         *\n         * @readonly\n         * @member {number}\n         */\n        this.progressChunk = 0;\n\n        /**\n         * The `dequeue` method that will be used a storage place for the async queue dequeue method\n         * used privately by the loader.\n         *\n         * @private\n         * @member {function}\n         */\n        this._dequeue = _noop;\n\n        /**\n         * Used a storage place for the on load binding used privately by the loader.\n         *\n         * @private\n         * @member {function}\n         */\n        this._onLoadBinding = null;\n\n        /**\n         * The timer for element loads to check if they timeout.\n         *\n         * @private\n         * @member {number}\n         */\n        this._elementTimer = 0;\n\n        /**\n         * The `complete` function bound to this resource's context.\n         *\n         * @private\n         * @member {function}\n         */\n        this._boundComplete = this.complete.bind(this);\n\n        /**\n         * The `_onError` function bound to this resource's context.\n         *\n         * @private\n         * @member {function}\n         */\n        this._boundOnError = this._onError.bind(this);\n\n        /**\n         * The `_onProgress` function bound to this resource's context.\n         *\n         * @private\n         * @member {function}\n         */\n        this._boundOnProgress = this._onProgress.bind(this);\n\n        /**\n         * The `_onTimeout` function bound to this resource's context.\n         *\n         * @private\n         * @member {function}\n         */\n        this._boundOnTimeout = this._onTimeout.bind(this);\n\n        // xhr callbacks\n        this._boundXhrOnError = this._xhrOnError.bind(this);\n        this._boundXhrOnTimeout = this._xhrOnTimeout.bind(this);\n        this._boundXhrOnAbort = this._xhrOnAbort.bind(this);\n        this._boundXhrOnLoad = this._xhrOnLoad.bind(this);\n\n        /**\n         * Dispatched when the resource beings to load.\n         *\n         * The callback looks like {@link Resource.OnStartSignal}.\n         *\n         * @member {Signal<Resource.OnStartSignal>}\n         */\n        this.onStart = new Signal();\n\n        /**\n         * Dispatched each time progress of this resource load updates.\n         * Not all resources types and loader systems can support this event\n         * so sometimes it may not be available. If the resource\n         * is being loaded on a modern browser, using XHR, and the remote server\n         * properly sets Content-Length headers, then this will be available.\n         *\n         * The callback looks like {@link Resource.OnProgressSignal}.\n         *\n         * @member {Signal<Resource.OnProgressSignal>}\n         */\n        this.onProgress = new Signal();\n\n        /**\n         * Dispatched once this resource has loaded, if there was an error it will\n         * be in the `error` property.\n         *\n         * The callback looks like {@link Resource.OnCompleteSignal}.\n         *\n         * @member {Signal<Resource.OnCompleteSignal>}\n         */\n        this.onComplete = new Signal();\n\n        /**\n         * Dispatched after this resource has had all the *after* middleware run on it.\n         *\n         * The callback looks like {@link Resource.OnCompleteSignal}.\n         *\n         * @member {Signal<Resource.OnCompleteSignal>}\n         */\n        this.onAfterMiddleware = new Signal();\n    }\n\n    /**\n     * When the resource starts to load.\n     *\n     * @memberof Resource\n     * @callback OnStartSignal\n     * @param {Resource} resource - The resource that the event happened on.\n     */\n\n    /**\n     * When the resource reports loading progress.\n     *\n     * @memberof Resource\n     * @callback OnProgressSignal\n     * @param {Resource} resource - The resource that the event happened on.\n     * @param {number} percentage - The progress of the load in the range [0, 1].\n     */\n\n    /**\n     * When the resource finishes loading.\n     *\n     * @memberof Resource\n     * @callback OnCompleteSignal\n     * @param {Resource} resource - The resource that the event happened on.\n     */\n\n    /**\n     * @memberof Resource\n     * @typedef {object} IMetadata\n     * @property {HTMLImageElement|HTMLAudioElement|HTMLVideoElement} [loadElement=null] - The\n     *      element to use for loading, instead of creating one.\n     * @property {boolean} [skipSource=false] - Skips adding source(s) to the load element. This\n     *      is useful if you want to pass in a `loadElement` that you already added load sources to.\n     * @property {string|string[]} [mimeType] - The mime type to use for the source element\n     *      of a video/audio elment. If the urls are an array, you can pass this as an array as well\n     *      where each index is the mime type to use for the corresponding url index.\n     */\n\n    /**\n     * Stores whether or not this url is a data url.\n     *\n     * @readonly\n     * @member {boolean}\n     */\n    get isDataUrl() {\n        return this._hasFlag(Resource.STATUS_FLAGS.DATA_URL);\n    }\n\n    /**\n     * Describes if this resource has finished loading. Is true when the resource has completely\n     * loaded.\n     *\n     * @readonly\n     * @member {boolean}\n     */\n    get isComplete() {\n        return this._hasFlag(Resource.STATUS_FLAGS.COMPLETE);\n    }\n\n    /**\n     * Describes if this resource is currently loading. Is true when the resource starts loading,\n     * and is false again when complete.\n     *\n     * @readonly\n     * @member {boolean}\n     */\n    get isLoading() {\n        return this._hasFlag(Resource.STATUS_FLAGS.LOADING);\n    }\n\n    /**\n     * Marks the resource as complete.\n     *\n     */\n    complete() {\n        this._clearEvents();\n        this._finish();\n    }\n\n    /**\n     * Aborts the loading of this resource, with an optional message.\n     *\n     * @param {string} message - The message to use for the error\n     */\n    abort(message) {\n        // abort can be called multiple times, ignore subsequent calls.\n        if (this.error) {\n            return;\n        }\n\n        // store error\n        this.error = new Error(message);\n\n        // clear events before calling aborts\n        this._clearEvents();\n\n        // abort the actual loading\n        if (this.xhr) {\n            this.xhr.abort();\n        }\n        else if (this.xdr) {\n            this.xdr.abort();\n        }\n        else if (this.data) {\n            // single source\n            if (this.data.src) {\n                this.data.src = Resource.EMPTY_GIF;\n            }\n            // multi-source\n            else {\n                while (this.data.firstChild) {\n                    this.data.removeChild(this.data.firstChild);\n                }\n            }\n        }\n\n        // done now.\n        this._finish();\n    }\n\n    /**\n     * Kicks off loading of this resource. This method is asynchronous.\n     *\n     * @param {Resource.OnCompleteSignal} [cb] - Optional callback to call once the resource is loaded.\n     */\n    load(cb) {\n        if (this.isLoading) {\n            return;\n        }\n\n        if (this.isComplete) {\n            if (cb) {\n                setTimeout(() => cb(this), 1);\n            }\n\n            return;\n        }\n        else if (cb) {\n            this.onComplete.once(cb);\n        }\n\n        this._setFlag(Resource.STATUS_FLAGS.LOADING, true);\n\n        this.onStart.dispatch(this);\n\n        // if unset, determine the value\n        if (this.crossOrigin === false || typeof this.crossOrigin !== 'string') {\n            this.crossOrigin = this._determineCrossOrigin(this.url);\n        }\n\n        switch (this.loadType) {\n            case Resource.LOAD_TYPE.IMAGE:\n                this.type = Resource.TYPE.IMAGE;\n                this._loadElement('image');\n                break;\n\n            case Resource.LOAD_TYPE.AUDIO:\n                this.type = Resource.TYPE.AUDIO;\n                this._loadSourceElement('audio');\n                break;\n\n            case Resource.LOAD_TYPE.VIDEO:\n                this.type = Resource.TYPE.VIDEO;\n                this._loadSourceElement('video');\n                break;\n\n            case Resource.LOAD_TYPE.XHR:\n                /* falls through */\n            default:\n                if (useXdr && this.crossOrigin) {\n                    this._loadXdr();\n                }\n                else {\n                    this._loadXhr();\n                }\n                break;\n        }\n    }\n\n    /**\n     * Checks if the flag is set.\n     *\n     * @private\n     * @param {number} flag - The flag to check.\n     * @return {boolean} True if the flag is set.\n     */\n    _hasFlag(flag) {\n        return (this._flags & flag) !== 0;\n    }\n\n    /**\n     * (Un)Sets the flag.\n     *\n     * @private\n     * @param {number} flag - The flag to (un)set.\n     * @param {boolean} value - Whether to set or (un)set the flag.\n     */\n    _setFlag(flag, value) {\n        this._flags = value ? (this._flags | flag) : (this._flags & ~flag);\n    }\n\n    /**\n     * Clears all the events from the underlying loading source.\n     *\n     * @private\n     */\n    _clearEvents() {\n        clearTimeout(this._elementTimer);\n\n        if (this.data && this.data.removeEventListener) {\n            this.data.removeEventListener('error', this._boundOnError, false);\n            this.data.removeEventListener('load', this._boundComplete, false);\n            this.data.removeEventListener('progress', this._boundOnProgress, false);\n            this.data.removeEventListener('canplaythrough', this._boundComplete, false);\n        }\n\n        if (this.xhr) {\n            if (this.xhr.removeEventListener) {\n                this.xhr.removeEventListener('error', this._boundXhrOnError, false);\n                this.xhr.removeEventListener('timeout', this._boundXhrOnTimeout, false);\n                this.xhr.removeEventListener('abort', this._boundXhrOnAbort, false);\n                this.xhr.removeEventListener('progress', this._boundOnProgress, false);\n                this.xhr.removeEventListener('load', this._boundXhrOnLoad, false);\n            }\n            else {\n                this.xhr.onerror = null;\n                this.xhr.ontimeout = null;\n                this.xhr.onprogress = null;\n                this.xhr.onload = null;\n            }\n        }\n    }\n\n    /**\n     * Finalizes the load.\n     *\n     * @private\n     */\n    _finish() {\n        if (this.isComplete) {\n            throw new Error('Complete called again for an already completed resource.');\n        }\n\n        this._setFlag(Resource.STATUS_FLAGS.COMPLETE, true);\n        this._setFlag(Resource.STATUS_FLAGS.LOADING, false);\n\n        this.onComplete.dispatch(this);\n    }\n\n    /**\n     * Loads this resources using an element that has a single source,\n     * like an HTMLImageElement.\n     *\n     * @private\n     * @param {string} type - The type of element to use.\n     */\n    _loadElement(type) {\n        if (this.metadata.loadElement) {\n            this.data = this.metadata.loadElement;\n        }\n        else if (type === 'image' && typeof window.Image !== 'undefined') {\n            this.data = new Image();\n        }\n        else {\n            this.data = document.createElement(type);\n        }\n\n        if (this.crossOrigin) {\n            this.data.crossOrigin = this.crossOrigin;\n        }\n\n        if (!this.metadata.skipSource) {\n            this.data.src = this.url;\n        }\n\n        this.data.addEventListener('error', this._boundOnError, false);\n        this.data.addEventListener('load', this._boundComplete, false);\n        this.data.addEventListener('progress', this._boundOnProgress, false);\n\n        if (this.timeout) {\n            this._elementTimer = setTimeout(this._boundOnTimeout, this.timeout);\n        }\n    }\n\n    /**\n     * Loads this resources using an element that has multiple sources,\n     * like an HTMLAudioElement or HTMLVideoElement.\n     *\n     * @private\n     * @param {string} type - The type of element to use.\n     */\n    _loadSourceElement(type) {\n        if (this.metadata.loadElement) {\n            this.data = this.metadata.loadElement;\n        }\n        else if (type === 'audio' && typeof window.Audio !== 'undefined') {\n            this.data = new Audio();\n        }\n        else {\n            this.data = document.createElement(type);\n        }\n\n        if (this.data === null) {\n            this.abort(`Unsupported element: ${type}`);\n\n            return;\n        }\n\n        if (this.crossOrigin) {\n            this.data.crossOrigin = this.crossOrigin;\n        }\n\n        if (!this.metadata.skipSource) {\n            // support for CocoonJS Canvas+ runtime, lacks document.createElement('source')\n            if (navigator.isCocoonJS) {\n                this.data.src = Array.isArray(this.url) ? this.url[0] : this.url;\n            }\n            else if (Array.isArray(this.url)) {\n                const mimeTypes = this.metadata.mimeType;\n\n                for (let i = 0; i < this.url.length; ++i) {\n                    this.data.appendChild(\n                        this._createSource(type, this.url[i], Array.isArray(mimeTypes) ? mimeTypes[i] : mimeTypes)\n                    );\n                }\n            }\n            else {\n                const mimeTypes = this.metadata.mimeType;\n\n                this.data.appendChild(\n                    this._createSource(type, this.url, Array.isArray(mimeTypes) ? mimeTypes[0] : mimeTypes)\n                );\n            }\n        }\n\n        this.data.addEventListener('error', this._boundOnError, false);\n        this.data.addEventListener('load', this._boundComplete, false);\n        this.data.addEventListener('progress', this._boundOnProgress, false);\n        this.data.addEventListener('canplaythrough', this._boundComplete, false);\n\n        this.data.load();\n\n        if (this.timeout) {\n            this._elementTimer = setTimeout(this._boundOnTimeout, this.timeout);\n        }\n    }\n\n    /**\n     * Loads this resources using an XMLHttpRequest.\n     *\n     * @private\n     */\n    _loadXhr() {\n        // if unset, determine the value\n        if (typeof this.xhrType !== 'string') {\n            this.xhrType = this._determineXhrType();\n        }\n\n        const xhr = this.xhr = new XMLHttpRequest();\n\n        // set the request type and url\n        xhr.open('GET', this.url, true);\n\n        xhr.timeout = this.timeout;\n\n        // load json as text and parse it ourselves. We do this because some browsers\n        // *cough* safari *cough* can't deal with it.\n        if (this.xhrType === Resource.XHR_RESPONSE_TYPE.JSON || this.xhrType === Resource.XHR_RESPONSE_TYPE.DOCUMENT) {\n            xhr.responseType = Resource.XHR_RESPONSE_TYPE.TEXT;\n        }\n        else {\n            xhr.responseType = this.xhrType;\n        }\n\n        xhr.addEventListener('error', this._boundXhrOnError, false);\n        xhr.addEventListener('timeout', this._boundXhrOnTimeout, false);\n        xhr.addEventListener('abort', this._boundXhrOnAbort, false);\n        xhr.addEventListener('progress', this._boundOnProgress, false);\n        xhr.addEventListener('load', this._boundXhrOnLoad, false);\n\n        xhr.send();\n    }\n\n    /**\n     * Loads this resources using an XDomainRequest. This is here because we need to support IE9 (gross).\n     *\n     * @private\n     */\n    _loadXdr() {\n        // if unset, determine the value\n        if (typeof this.xhrType !== 'string') {\n            this.xhrType = this._determineXhrType();\n        }\n\n        const xdr = this.xhr = new XDomainRequest(); // eslint-disable-line no-undef\n\n        // XDomainRequest has a few quirks. Occasionally it will abort requests\n        // A way to avoid this is to make sure ALL callbacks are set even if not used\n        // More info here: http://stackoverflow.com/questions/15786966/xdomainrequest-aborts-post-on-ie-9\n        xdr.timeout = this.timeout || 5000; // XDR needs a timeout value or it breaks in IE9\n\n        xdr.onerror = this._boundXhrOnError;\n        xdr.ontimeout = this._boundXhrOnTimeout;\n        xdr.onprogress = this._boundOnProgress;\n        xdr.onload = this._boundXhrOnLoad;\n\n        xdr.open('GET', this.url, true);\n\n        // Note: The xdr.send() call is wrapped in a timeout to prevent an\n        // issue with the interface where some requests are lost if multiple\n        // XDomainRequests are being sent at the same time.\n        // Some info here: https://github.com/photonstorm/phaser/issues/1248\n        setTimeout(() => xdr.send(), 1);\n    }\n\n    /**\n     * Creates a source used in loading via an element.\n     *\n     * @private\n     * @param {string} type - The element type (video or audio).\n     * @param {string} url - The source URL to load from.\n     * @param {string} [mime] - The mime type of the video\n     * @return {HTMLSourceElement} The source element.\n     */\n    _createSource(type, url, mime) {\n        if (!mime) {\n            mime = `${type}/${this._getExtension(url)}`;\n        }\n\n        const source = document.createElement('source');\n\n        source.src = url;\n        source.type = mime;\n\n        return source;\n    }\n\n    /**\n     * Called if a load errors out.\n     *\n     * @param {Event} event - The error event from the element that emits it.\n     * @private\n     */\n    _onError(event) {\n        this.abort(`Failed to load element using: ${event.target.nodeName}`);\n    }\n\n    /**\n     * Called if a load progress event fires for an element or xhr/xdr.\n     *\n     * @private\n     * @param {XMLHttpRequestProgressEvent|Event} event - Progress event.\n     */\n    _onProgress(event) {\n        if (event && event.lengthComputable) {\n            this.onProgress.dispatch(this, event.loaded / event.total);\n        }\n    }\n\n    /**\n     * Called if a timeout event fires for an element.\n     *\n     * @private\n     */\n    _onTimeout() {\n        this.abort(`Load timed out.`);\n    }\n\n    /**\n     * Called if an error event fires for xhr/xdr.\n     *\n     * @private\n     */\n    _xhrOnError() {\n        const xhr = this.xhr;\n\n        this.abort(`${reqType(xhr)} Request failed. Status: ${xhr.status}, text: \"${xhr.statusText}\"`);\n    }\n\n    /**\n     * Called if an error event fires for xhr/xdr.\n     *\n     * @private\n     */\n    _xhrOnTimeout() {\n        const xhr = this.xhr;\n\n        this.abort(`${reqType(xhr)} Request timed out.`);\n    }\n\n    /**\n     * Called if an abort event fires for xhr/xdr.\n     *\n     * @private\n     */\n    _xhrOnAbort() {\n        const xhr = this.xhr;\n\n        this.abort(`${reqType(xhr)} Request was aborted by the user.`);\n    }\n\n    /**\n     * Called when data successfully loads from an xhr/xdr request.\n     *\n     * @private\n     * @param {XMLHttpRequestLoadEvent|Event} event - Load event\n     */\n    _xhrOnLoad() {\n        const xhr = this.xhr;\n        let text = '';\n        let status = typeof xhr.status === 'undefined' ? STATUS_OK : xhr.status; // XDR has no `.status`, assume 200.\n\n        // responseText is accessible only if responseType is '' or 'text' and on older browsers\n        if (xhr.responseType === '' || xhr.responseType === 'text' || typeof xhr.responseType === 'undefined') {\n            text = xhr.responseText;\n        }\n\n        // status can be 0 when using the `file://` protocol so we also check if a response is set.\n        // If it has a response, we assume 200; otherwise a 0 status code with no contents is an aborted request.\n        if (status === STATUS_NONE && (text.length > 0 || xhr.responseType === Resource.XHR_RESPONSE_TYPE.BUFFER)) {\n            status = STATUS_OK;\n        }\n        // handle IE9 bug: http://stackoverflow.com/questions/10046972/msie-returns-status-code-of-1223-for-ajax-request\n        else if (status === STATUS_IE_BUG_EMPTY) {\n            status = STATUS_EMPTY;\n        }\n\n        const statusType = (status / 100) | 0;\n\n        if (statusType === STATUS_TYPE_OK) {\n            // if text, just return it\n            if (this.xhrType === Resource.XHR_RESPONSE_TYPE.TEXT) {\n                this.data = text;\n                this.type = Resource.TYPE.TEXT;\n            }\n            // if json, parse into json object\n            else if (this.xhrType === Resource.XHR_RESPONSE_TYPE.JSON) {\n                try {\n                    this.data = JSON.parse(text);\n                    this.type = Resource.TYPE.JSON;\n                }\n                catch (e) {\n                    this.abort(`Error trying to parse loaded json: ${e}`);\n\n                    return;\n                }\n            }\n            // if xml, parse into an xml document or div element\n            else if (this.xhrType === Resource.XHR_RESPONSE_TYPE.DOCUMENT) {\n                try {\n                    if (window.DOMParser) {\n                        const domparser = new DOMParser();\n\n                        this.data = domparser.parseFromString(text, 'text/xml');\n                    }\n                    else {\n                        const div = document.createElement('div');\n\n                        div.innerHTML = text;\n\n                        this.data = div;\n                    }\n\n                    this.type = Resource.TYPE.XML;\n                }\n                catch (e) {\n                    this.abort(`Error trying to parse loaded xml: ${e}`);\n\n                    return;\n                }\n            }\n            // other types just return the response\n            else {\n                this.data = xhr.response || text;\n            }\n        }\n        else {\n            this.abort(`[${xhr.status}] ${xhr.statusText}: ${xhr.responseURL}`);\n\n            return;\n        }\n\n        this.complete();\n    }\n\n    /**\n     * Sets the `crossOrigin` property for this resource based on if the url\n     * for this resource is cross-origin. If crossOrigin was manually set, this\n     * function does nothing.\n     *\n     * @private\n     * @param {string} url - The url to test.\n     * @param {object} [loc=window.location] - The location object to test against.\n     * @return {string} The crossOrigin value to use (or empty string for none).\n     */\n    _determineCrossOrigin(url, loc) {\n        // data: and javascript: urls are considered same-origin\n        if (url.indexOf('data:') === 0) {\n            return '';\n        }\n\n        // A sandboxed iframe without the 'allow-same-origin' attribute will have a special\n        // origin designed not to match window.location.origin, and will always require\n        // crossOrigin requests regardless of whether the location matches.\n        if (window.origin !== window.location.origin) {\n            return 'anonymous';\n        }\n\n        // default is window.location\n        loc = loc || window.location;\n\n        if (!tempAnchor) {\n            tempAnchor = document.createElement('a');\n        }\n\n        // let the browser determine the full href for the url of this resource and then\n        // parse with the node url lib, we can't use the properties of the anchor element\n        // because they don't work in IE9 :(\n        tempAnchor.href = url;\n        url = parseUri(tempAnchor.href, { strictMode: true });\n\n        const samePort = (!url.port && loc.port === '') || (url.port === loc.port);\n        const protocol = url.protocol ? `${url.protocol}:` : '';\n\n        // if cross origin\n        if (url.host !== loc.hostname || !samePort || protocol !== loc.protocol) {\n            return 'anonymous';\n        }\n\n        return '';\n    }\n\n    /**\n     * Determines the responseType of an XHR request based on the extension of the\n     * resource being loaded.\n     *\n     * @private\n     * @return {Resource.XHR_RESPONSE_TYPE} The responseType to use.\n     */\n    _determineXhrType() {\n        return Resource._xhrTypeMap[this.extension] || Resource.XHR_RESPONSE_TYPE.TEXT;\n    }\n\n    /**\n     * Determines the loadType of a resource based on the extension of the\n     * resource being loaded.\n     *\n     * @private\n     * @return {Resource.LOAD_TYPE} The loadType to use.\n     */\n    _determineLoadType() {\n        return Resource._loadTypeMap[this.extension] || Resource.LOAD_TYPE.XHR;\n    }\n\n    /**\n     * Extracts the extension (sans '.') of the file being loaded by the resource.\n     *\n     * @private\n     * @return {string} The extension.\n     */\n    _getExtension() {\n        let url = this.url;\n        let ext = '';\n\n        if (this.isDataUrl) {\n            const slashIndex = url.indexOf('/');\n\n            ext = url.substring(slashIndex + 1, url.indexOf(';', slashIndex));\n        }\n        else {\n            const queryStart = url.indexOf('?');\n            const hashStart = url.indexOf('#');\n            const index = Math.min(\n                queryStart > -1 ? queryStart : url.length,\n                hashStart > -1 ? hashStart : url.length\n            );\n\n            url = url.substring(0, index);\n            ext = url.substring(url.lastIndexOf('.') + 1);\n        }\n\n        return ext.toLowerCase();\n    }\n\n    /**\n     * Determines the mime type of an XHR request based on the responseType of\n     * resource being loaded.\n     *\n     * @private\n     * @param {Resource.XHR_RESPONSE_TYPE} type - The type to get a mime type for.\n     * @return {string} The mime type to use.\n     */\n    _getMimeFromXhrType(type) {\n        switch (type) {\n            case Resource.XHR_RESPONSE_TYPE.BUFFER:\n                return 'application/octet-binary';\n\n            case Resource.XHR_RESPONSE_TYPE.BLOB:\n                return 'application/blob';\n\n            case Resource.XHR_RESPONSE_TYPE.DOCUMENT:\n                return 'application/xml';\n\n            case Resource.XHR_RESPONSE_TYPE.JSON:\n                return 'application/json';\n\n            case Resource.XHR_RESPONSE_TYPE.DEFAULT:\n            case Resource.XHR_RESPONSE_TYPE.TEXT:\n                /* falls through */\n            default:\n                return 'text/plain';\n        }\n    }\n}\n\n/**\n * The types of resources a resource could represent.\n *\n * @static\n * @readonly\n * @enum {number}\n */\nResource.STATUS_FLAGS = {\n    NONE:       0,\n    DATA_URL:   (1 << 0),\n    COMPLETE:   (1 << 1),\n    LOADING:    (1 << 2),\n};\n\n/**\n * The types of resources a resource could represent.\n *\n * @static\n * @readonly\n * @enum {number}\n */\nResource.TYPE = {\n    UNKNOWN:    0,\n    JSON:       1,\n    XML:        2,\n    IMAGE:      3,\n    AUDIO:      4,\n    VIDEO:      5,\n    TEXT:       6,\n};\n\n/**\n * The types of loading a resource can use.\n *\n * @static\n * @readonly\n * @enum {number}\n */\nResource.LOAD_TYPE = {\n    /** Uses XMLHttpRequest to load the resource. */\n    XHR:    1,\n    /** Uses an `Image` object to load the resource. */\n    IMAGE:  2,\n    /** Uses an `Audio` object to load the resource. */\n    AUDIO:  3,\n    /** Uses a `Video` object to load the resource. */\n    VIDEO:  4,\n};\n\n/**\n * The XHR ready states, used internally.\n *\n * @static\n * @readonly\n * @enum {string}\n */\nResource.XHR_RESPONSE_TYPE = {\n    /** string */\n    DEFAULT:    'text',\n    /** ArrayBuffer */\n    BUFFER:     'arraybuffer',\n    /** Blob */\n    BLOB:       'blob',\n    /** Document */\n    DOCUMENT:   'document',\n    /** Object */\n    JSON:       'json',\n    /** String */\n    TEXT:       'text',\n};\n\nResource._loadTypeMap = {\n    // images\n    gif:        Resource.LOAD_TYPE.IMAGE,\n    png:        Resource.LOAD_TYPE.IMAGE,\n    bmp:        Resource.LOAD_TYPE.IMAGE,\n    jpg:        Resource.LOAD_TYPE.IMAGE,\n    jpeg:       Resource.LOAD_TYPE.IMAGE,\n    tif:        Resource.LOAD_TYPE.IMAGE,\n    tiff:       Resource.LOAD_TYPE.IMAGE,\n    webp:       Resource.LOAD_TYPE.IMAGE,\n    tga:        Resource.LOAD_TYPE.IMAGE,\n    svg:        Resource.LOAD_TYPE.IMAGE,\n    'svg+xml':  Resource.LOAD_TYPE.IMAGE, // for SVG data urls\n\n    // audio\n    mp3:        Resource.LOAD_TYPE.AUDIO,\n    ogg:        Resource.LOAD_TYPE.AUDIO,\n    wav:        Resource.LOAD_TYPE.AUDIO,\n\n    // videos\n    mp4:        Resource.LOAD_TYPE.VIDEO,\n    webm:       Resource.LOAD_TYPE.VIDEO,\n};\n\nResource._xhrTypeMap = {\n    // xml\n    xhtml:      Resource.XHR_RESPONSE_TYPE.DOCUMENT,\n    html:       Resource.XHR_RESPONSE_TYPE.DOCUMENT,\n    htm:        Resource.XHR_RESPONSE_TYPE.DOCUMENT,\n    xml:        Resource.XHR_RESPONSE_TYPE.DOCUMENT,\n    tmx:        Resource.XHR_RESPONSE_TYPE.DOCUMENT,\n    svg:        Resource.XHR_RESPONSE_TYPE.DOCUMENT,\n\n    // This was added to handle Tiled Tileset XML, but .tsx is also a TypeScript React Component.\n    // Since it is way less likely for people to be loading TypeScript files instead of Tiled files,\n    // this should probably be fine.\n    tsx:        Resource.XHR_RESPONSE_TYPE.DOCUMENT,\n\n    // images\n    gif:        Resource.XHR_RESPONSE_TYPE.BLOB,\n    png:        Resource.XHR_RESPONSE_TYPE.BLOB,\n    bmp:        Resource.XHR_RESPONSE_TYPE.BLOB,\n    jpg:        Resource.XHR_RESPONSE_TYPE.BLOB,\n    jpeg:       Resource.XHR_RESPONSE_TYPE.BLOB,\n    tif:        Resource.XHR_RESPONSE_TYPE.BLOB,\n    tiff:       Resource.XHR_RESPONSE_TYPE.BLOB,\n    webp:       Resource.XHR_RESPONSE_TYPE.BLOB,\n    tga:        Resource.XHR_RESPONSE_TYPE.BLOB,\n\n    // json\n    json:       Resource.XHR_RESPONSE_TYPE.JSON,\n\n    // text\n    text:       Resource.XHR_RESPONSE_TYPE.TEXT,\n    txt:        Resource.XHR_RESPONSE_TYPE.TEXT,\n\n    // fonts\n    ttf:        Resource.XHR_RESPONSE_TYPE.BUFFER,\n    otf:        Resource.XHR_RESPONSE_TYPE.BUFFER,\n};\n\n// We can't set the `src` attribute to empty string, so on abort we set it to this 1px transparent gif\nResource.EMPTY_GIF = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';\n\n/**\n * Quick helper to set a value on one of the extension maps. Ensures there is no\n * dot at the start of the extension.\n *\n * @ignore\n * @param {object} map - The map to set on.\n * @param {string} extname - The extension (or key) to set.\n * @param {number} val - The value to set.\n */\nfunction setExtMap(map, extname, val) {\n    if (extname && extname.indexOf('.') === 0) {\n        extname = extname.substring(1);\n    }\n\n    if (!extname) {\n        return;\n    }\n\n    map[extname] = val;\n}\n\n/**\n * Quick helper to get string xhr type.\n *\n * @ignore\n * @param {XMLHttpRequest|XDomainRequest} xhr - The request to check.\n * @return {string} The type.\n */\nfunction reqType(xhr) {\n    return xhr.toString().replace('object ', '');\n}\n\nexport { Resource };\n","const _keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n/**\n * Encodes binary into base64.\n *\n * @function encodeBinary\n * @param {string} input The input data to encode.\n * @returns {string} The encoded base64 string\n */\nexport function encodeBinary(input) {\n    let output = '';\n    let inx = 0;\n\n    while (inx < input.length) {\n        // Fill byte buffer array\n        const bytebuffer = [0, 0, 0];\n        const encodedCharIndexes = [0, 0, 0, 0];\n\n        for (let jnx = 0; jnx < bytebuffer.length; ++jnx) {\n            if (inx < input.length) {\n                // throw away high-order byte, as documented at:\n                // https://developer.mozilla.org/En/Using_XMLHttpRequest#Handling_binary_data\n                bytebuffer[jnx] = input.charCodeAt(inx++) & 0xff;\n            }\n            else {\n                bytebuffer[jnx] = 0;\n            }\n        }\n\n        // Get each encoded character, 6 bits at a time\n        // index 1: first 6 bits\n        encodedCharIndexes[0] = bytebuffer[0] >> 2;\n\n        // index 2: second 6 bits (2 least significant bits from input byte 1 + 4 most significant bits from byte 2)\n        encodedCharIndexes[1] = ((bytebuffer[0] & 0x3) << 4) | (bytebuffer[1] >> 4);\n\n        // index 3: third 6 bits (4 least significant bits from input byte 2 + 2 most significant bits from byte 3)\n        encodedCharIndexes[2] = ((bytebuffer[1] & 0x0f) << 2) | (bytebuffer[2] >> 6);\n\n        // index 3: forth 6 bits (6 least significant bits from input byte 3)\n        encodedCharIndexes[3] = bytebuffer[2] & 0x3f;\n\n        // Determine whether padding happened, and adjust accordingly\n        const paddingBytes = inx - (input.length - 1);\n\n        switch (paddingBytes) {\n            case 2:\n                // Set last 2 characters to padding char\n                encodedCharIndexes[3] = 64;\n                encodedCharIndexes[2] = 64;\n                break;\n\n            case 1:\n                // Set last character to padding char\n                encodedCharIndexes[3] = 64;\n                break;\n\n            default:\n                break; // No padding - proceed\n        }\n\n        // Now we will grab each appropriate character out of our keystring\n        // based on our index array and append it to the output string\n        for (let jnx = 0; jnx < encodedCharIndexes.length; ++jnx) {\n            output += _keyStr.charAt(encodedCharIndexes[jnx]);\n        }\n    }\n\n    return output;\n}\n","import { Resource } from '../Resource';\nimport { encodeBinary } from '../encodeBinary';\n\nconst Url = window.URL || window.webkitURL;\n\n/**\n * A middleware for transforming XHR loaded Blobs into more useful objects\n *\n * @memberof middleware\n * @function parsing\n * @example\n * import { Loader, middleware } from 'resource-loader';\n * const loader = new Loader();\n * loader.use(middleware.parsing);\n * @param {Resource} resource - Current Resource\n * @param {function} next - Callback when complete\n */\nexport function parsing(resource, next) {\n    if (!resource.data) {\n        next();\n\n        return;\n    }\n\n    // if this was an XHR load of a blob\n    if (resource.xhr && resource.xhrType === Resource.XHR_RESPONSE_TYPE.BLOB) {\n        // if there is no blob support we probably got a binary string back\n        if (!window.Blob || typeof resource.data === 'string') {\n            const type = resource.xhr.getResponseHeader('content-type');\n\n            // this is an image, convert the binary string into a data url\n            if (type && type.indexOf('image') === 0) {\n                resource.data = new Image();\n                resource.data.src = `data:${type};base64,${encodeBinary(resource.xhr.responseText)}`;\n\n                resource.type = Resource.TYPE.IMAGE;\n\n                // wait until the image loads and then callback\n                resource.data.onload = () => {\n                    resource.data.onload = null;\n\n                    next();\n                };\n\n                // next will be called on load\n                return;\n            }\n        }\n        // if content type says this is an image, then we should transform the blob into an Image object\n        else if (resource.data.type.indexOf('image') === 0) {\n            const src = Url.createObjectURL(resource.data);\n\n            resource.blob = resource.data;\n            resource.data = new Image();\n            resource.data.src = src;\n\n            resource.type = Resource.TYPE.IMAGE;\n\n            // cleanup the no longer used blob after the image loads\n            // TODO: Is this correct? Will the image be invalid after revoking?\n            resource.data.onload = () => {\n                Url.revokeObjectURL(src);\n                resource.data.onload = null;\n\n                next();\n            };\n\n            // next will be called on load.\n            return;\n        }\n    }\n\n    next();\n}\n","/**\n * @namespace middleware\n */\nexport * from './caching';\nexport * from './parsing';\n","import Signal from 'mini-signals';\nimport parseUri from 'parse-uri';\nimport * as async from './async';\nimport { Resource } from './Resource';\n\n// some constants\nconst MAX_PROGRESS = 100;\nconst rgxExtractUrlHash = /(#[\\w-]+)?$/;\n\n/**\n * Manages the state and loading of multiple resources to load.\n *\n * @class\n */\nclass Loader {\n    /**\n     * @param {string} [baseUrl=''] - The base url for all resources loaded by this loader.\n     * @param {number} [concurrency=10] - The number of resources to load concurrently.\n     */\n    constructor(baseUrl = '', concurrency = 10) {\n        /**\n         * The base url for all resources loaded by this loader.\n         *\n         * @member {string}\n         */\n        this.baseUrl = baseUrl;\n\n        /**\n         * The progress percent of the loader going through the queue.\n         *\n         * @member {number}\n         * @default 0\n         */\n        this.progress = 0;\n\n        /**\n         * Loading state of the loader, true if it is currently loading resources.\n         *\n         * @member {boolean}\n         * @default false\n         */\n        this.loading = false;\n\n        /**\n         * A querystring to append to every URL added to the loader.\n         *\n         * This should be a valid query string *without* the question-mark (`?`). The loader will\n         * also *not* escape values for you. Make sure to escape your parameters with\n         * [`encodeURIComponent`](https://mdn.io/encodeURIComponent) before assigning this property.\n         *\n         * @example\n         * const loader = new Loader();\n         *\n         * loader.defaultQueryString = 'user=me&password=secret';\n         *\n         * // This will request 'image.png?user=me&password=secret'\n         * loader.add('image.png').load();\n         *\n         * loader.reset();\n         *\n         * // This will request 'image.png?v=1&user=me&password=secret'\n         * loader.add('iamge.png?v=1').load();\n         *\n         * @member {string}\n         * @default ''\n         */\n        this.defaultQueryString = '';\n\n        /**\n         * The middleware to run before loading each resource.\n         *\n         * @private\n         * @member {function[]}\n         */\n        this._beforeMiddleware = [];\n\n        /**\n         * The middleware to run after loading each resource.\n         *\n         * @private\n         * @member {function[]}\n         */\n        this._afterMiddleware = [];\n\n        /**\n         * The tracks the resources we are currently completing parsing for.\n         *\n         * @private\n         * @member {Resource[]}\n         */\n        this._resourcesParsing = [];\n\n        /**\n         * The `_loadResource` function bound with this object context.\n         *\n         * @private\n         * @member {function}\n         * @param {Resource} r - The resource to load\n         * @param {Function} d - The dequeue function\n         * @return {undefined}\n         */\n        this._boundLoadResource = (r, d) => this._loadResource(r, d);\n\n        /**\n         * The resources waiting to be loaded.\n         *\n         * @private\n         * @member {Resource[]}\n         */\n        this._queue = async.queue(this._boundLoadResource, concurrency);\n\n        this._queue.pause();\n\n        /**\n         * All the resources for this loader keyed by name.\n         *\n         * @member {object<string, Resource>}\n         */\n        this.resources = {};\n\n        /**\n         * Dispatched once per loaded or errored resource.\n         *\n         * The callback looks like {@link Loader.OnProgressSignal}.\n         *\n         * @member {Signal<Loader.OnProgressSignal>}\n         */\n        this.onProgress = new Signal();\n\n        /**\n         * Dispatched once per errored resource.\n         *\n         * The callback looks like {@link Loader.OnErrorSignal}.\n         *\n         * @member {Signal<Loader.OnErrorSignal>}\n         */\n        this.onError = new Signal();\n\n        /**\n         * Dispatched once per loaded resource.\n         *\n         * The callback looks like {@link Loader.OnLoadSignal}.\n         *\n         * @member {Signal<Loader.OnLoadSignal>}\n         */\n        this.onLoad = new Signal();\n\n        /**\n         * Dispatched when the loader begins to process the queue.\n         *\n         * The callback looks like {@link Loader.OnStartSignal}.\n         *\n         * @member {Signal<Loader.OnStartSignal>}\n         */\n        this.onStart = new Signal();\n\n        /**\n         * Dispatched when the queued resources all load.\n         *\n         * The callback looks like {@link Loader.OnCompleteSignal}.\n         *\n         * @member {Signal<Loader.OnCompleteSignal>}\n         */\n        this.onComplete = new Signal();\n\n        // Add default before middleware\n        for (let i = 0; i < Loader._defaultBeforeMiddleware.length; ++i) {\n            this.pre(Loader._defaultBeforeMiddleware[i]);\n        }\n\n        // Add default after middleware\n        for (let i = 0; i < Loader._defaultAfterMiddleware.length; ++i) {\n            this.use(Loader._defaultAfterMiddleware[i]);\n        }\n    }\n\n    /**\n     * When the progress changes the loader and resource are disaptched.\n     *\n     * @memberof Loader\n     * @callback OnProgressSignal\n     * @param {Loader} loader - The loader the progress is advancing on.\n     * @param {Resource} resource - The resource that has completed or failed to cause the progress to advance.\n     */\n\n    /**\n     * When an error occurrs the loader and resource are disaptched.\n     *\n     * @memberof Loader\n     * @callback OnErrorSignal\n     * @param {Loader} loader - The loader the error happened in.\n     * @param {Resource} resource - The resource that caused the error.\n     */\n\n    /**\n     * When a load completes the loader and resource are disaptched.\n     *\n     * @memberof Loader\n     * @callback OnLoadSignal\n     * @param {Loader} loader - The loader that laoded the resource.\n     * @param {Resource} resource - The resource that has completed loading.\n     */\n\n    /**\n     * When the loader starts loading resources it dispatches this callback.\n     *\n     * @memberof Loader\n     * @callback OnStartSignal\n     * @param {Loader} loader - The loader that has started loading resources.\n     */\n\n    /**\n     * When the loader completes loading resources it dispatches this callback.\n     *\n     * @memberof Loader\n     * @callback OnCompleteSignal\n     * @param {Loader} loader - The loader that has finished loading resources.\n     */\n\n    /**\n     * Options for a call to `.add()`.\n     *\n     * @see Loader#add\n     *\n     * @typedef {object} IAddOptions\n     * @property {string} [name] - The name of the resource to load, if not passed the url is used.\n     * @property {string} [key] - Alias for `name`.\n     * @property {string} [url] - The url for this resource, relative to the baseUrl of this loader.\n     * @property {string|boolean} [crossOrigin] - Is this request cross-origin? Default is to\n     *      determine automatically.\n     * @property {number} [timeout=0] - A timeout in milliseconds for the load. If the load takes\n     *      longer than this time it is cancelled and the load is considered a failure. If this value is\n     *      set to `0` then there is no explicit timeout.\n     * @property {Resource.LOAD_TYPE} [loadType=Resource.LOAD_TYPE.XHR] - How should this resource\n     *      be loaded?\n     * @property {Resource.XHR_RESPONSE_TYPE} [xhrType=Resource.XHR_RESPONSE_TYPE.DEFAULT] - How\n     *      should the data being loaded be interpreted when using XHR?\n     * @property {Resource.OnCompleteSignal} [onComplete] - Callback to add an an onComplete signal istener.\n     * @property {Resource.OnCompleteSignal} [callback] - Alias for `onComplete`.\n     * @property {Resource.IMetadata} [metadata] - Extra configuration for middleware and the Resource object.\n     */\n\n    /* eslint-disable require-jsdoc,valid-jsdoc */\n    /**\n     * Adds a resource (or multiple resources) to the loader queue.\n     *\n     * This function can take a wide variety of different parameters. The only thing that is always\n     * required the url to load. All the following will work:\n     *\n     * ```js\n     * loader\n     *     // normal param syntax\n     *     .add('key', 'http://...', function () {})\n     *     .add('http://...', function () {})\n     *     .add('http://...')\n     *\n     *     // object syntax\n     *     .add({\n     *         name: 'key2',\n     *         url: 'http://...'\n     *     }, function () {})\n     *     .add({\n     *         url: 'http://...'\n     *     }, function () {})\n     *     .add({\n     *         name: 'key3',\n     *         url: 'http://...'\n     *         onComplete: function () {}\n     *     })\n     *     .add({\n     *         url: 'https://...',\n     *         onComplete: function () {},\n     *         crossOrigin: true\n     *     })\n     *\n     *     // you can also pass an array of objects or urls or both\n     *     .add([\n     *         { name: 'key4', url: 'http://...', onComplete: function () {} },\n     *         { url: 'http://...', onComplete: function () {} },\n     *         'http://...'\n     *     ])\n     *\n     *     // and you can use both params and options\n     *     .add('key', 'http://...', { crossOrigin: true }, function () {})\n     *     .add('http://...', { crossOrigin: true }, function () {});\n     * ```\n     *\n     * @function\n     * @variation 1\n     * @param {string} name - The name of the resource to load.\n     * @param {string} url - The url for this resource, relative to the baseUrl of this loader.\n     * @param {Resource.OnCompleteSignal} [callback] - Function to call when this specific resource completes loading.\n     * @return {this} Returns itself.\n     *//**\n     * @function\n     * @variation 2\n     * @param {string} name - The name of the resource to load.\n     * @param {string} url - The url for this resource, relative to the baseUrl of this loader.\n     * @param {IAddOptions} [options] - The options for the load.\n     * @param {Resource.OnCompleteSignal} [callback] - Function to call when this specific resource completes loading.\n     * @return {this} Returns itself.\n     *//**\n     * @function\n     * @variation 3\n     * @param {string} url - The url for this resource, relative to the baseUrl of this loader.\n     * @param {Resource.OnCompleteSignal} [callback] - Function to call when this specific resource completes loading.\n     * @return {this} Returns itself.\n     *//**\n     * @function\n     * @variation 4\n     * @param {string} url - The url for this resource, relative to the baseUrl of this loader.\n     * @param {IAddOptions} [options] - The options for the load.\n     * @param {Resource.OnCompleteSignal} [callback] - Function to call when this specific resource completes loading.\n     * @return {this} Returns itself.\n     *//**\n     * @function\n     * @variation 5\n     * @param {IAddOptions} options - The options for the load. This object must contain a `url` property.\n     * @param {Resource.OnCompleteSignal} [callback] - Function to call when this specific resource completes loading.\n     * @return {this} Returns itself.\n     *//**\n     * @function\n     * @variation 6\n     * @param {Array<IAddOptions|string>} resources - An array of resources to load, where each is\n     *      either an object with the options or a string url. If you pass an object, it must contain a `url` property.\n     * @param {Resource.OnCompleteSignal} [callback] - Function to call when this specific resource completes loading.\n     * @return {this} Returns itself.\n     */\n    add(name, url, options, cb) {\n        // special case of an array of objects or urls\n        if (Array.isArray(name)) {\n            for (let i = 0; i < name.length; ++i) {\n                this.add(name[i]);\n            }\n\n            return this;\n        }\n\n        // if an object is passed instead of params\n        if (typeof name === 'object') {\n            cb = url || name.callback || name.onComplete;\n            options = name;\n            url = name.url;\n            name = name.name || name.key || name.url;\n        }\n\n        // case where no name is passed shift all args over by one.\n        if (typeof url !== 'string') {\n            cb = options;\n            options = url;\n            url = name;\n        }\n\n        // now that we shifted make sure we have a proper url.\n        if (typeof url !== 'string') {\n            throw new Error('No url passed to add resource to loader.');\n        }\n\n        // options are optional so people might pass a function and no options\n        if (typeof options === 'function') {\n            cb = options;\n            options = null;\n        }\n\n        // if loading already you can only add resources that have a parent.\n        if (this.loading && (!options || !options.parentResource)) {\n            throw new Error('Cannot add resources while the loader is running.');\n        }\n\n        // check if resource already exists.\n        if (this.resources[name]) {\n            throw new Error(`Resource named \"${name}\" already exists.`);\n        }\n\n        // add base url if this isn't an absolute url\n        url = this._prepareUrl(url);\n\n        // create the store the resource\n        this.resources[name] = new Resource(name, url, options);\n\n        if (typeof cb === 'function') {\n            this.resources[name].onAfterMiddleware.once(cb);\n        }\n\n        // if actively loading, make sure to adjust progress chunks for that parent and its children\n        if (this.loading) {\n            const parent = options.parentResource;\n            const incompleteChildren = [];\n\n            for (let i = 0; i < parent.children.length; ++i) {\n                if (!parent.children[i].isComplete) {\n                    incompleteChildren.push(parent.children[i]);\n                }\n            }\n\n            const fullChunk = parent.progressChunk * (incompleteChildren.length + 1); // +1 for parent\n            const eachChunk = fullChunk / (incompleteChildren.length + 2); // +2 for parent & new child\n\n            parent.children.push(this.resources[name]);\n            parent.progressChunk = eachChunk;\n\n            for (let i = 0; i < incompleteChildren.length; ++i) {\n                incompleteChildren[i].progressChunk = eachChunk;\n            }\n\n            this.resources[name].progressChunk = eachChunk;\n        }\n\n        // add the resource to the queue\n        this._queue.push(this.resources[name]);\n\n        return this;\n    }\n    /* eslint-enable require-jsdoc,valid-jsdoc */\n\n    /**\n     * Sets up a middleware function that will run *before* the\n     * resource is loaded.\n     *\n     * @param {function} fn - The middleware function to register.\n     * @return {this} Returns itself.\n     */\n    pre(fn) {\n        this._beforeMiddleware.push(fn);\n\n        return this;\n    }\n\n    /**\n     * Sets up a middleware function that will run *after* the\n     * resource is loaded.\n     *\n     * @param {function} fn - The middleware function to register.\n     * @return {this} Returns itself.\n     */\n    use(fn) {\n        this._afterMiddleware.push(fn);\n\n        return this;\n    }\n\n    /**\n     * Resets the queue of the loader to prepare for a new load.\n     *\n     * @return {this} Returns itself.\n     */\n    reset() {\n        this.progress = 0;\n        this.loading = false;\n\n        this._queue.kill();\n        this._queue.pause();\n\n        // abort all resource loads\n        for (const k in this.resources) {\n            const res = this.resources[k];\n\n            if (res._onLoadBinding) {\n                res._onLoadBinding.detach();\n            }\n\n            if (res.isLoading) {\n                res.abort();\n            }\n        }\n\n        this.resources = {};\n\n        return this;\n    }\n\n    /**\n     * Starts loading the queued resources.\n     *\n     * @param {function} [cb] - Optional callback that will be bound to the `complete` event.\n     * @return {this} Returns itself.\n     */\n    load(cb) {\n        // register complete callback if they pass one\n        if (typeof cb === 'function') {\n            this.onComplete.once(cb);\n        }\n\n        // if the queue has already started we are done here\n        if (this.loading) {\n            return this;\n        }\n\n        if (this._queue.idle()) {\n            this._onStart();\n            this._onComplete();\n        }\n        else {\n            // distribute progress chunks\n            const numTasks = this._queue._tasks.length;\n            const chunk = MAX_PROGRESS / numTasks;\n\n            for (let i = 0; i < this._queue._tasks.length; ++i) {\n                this._queue._tasks[i].data.progressChunk = chunk;\n            }\n\n            // notify we are starting\n            this._onStart();\n\n            // start loading\n            this._queue.resume();\n        }\n\n        return this;\n    }\n\n    /**\n     * The number of resources to load concurrently.\n     *\n     * @member {number}\n     * @default 10\n     */\n    get concurrency() {\n        return this._queue.concurrency;\n    }\n    // eslint-disable-next-line require-jsdoc\n    set concurrency(concurrency) {\n        this._queue.concurrency = concurrency;\n    }\n\n    /**\n     * Prepares a url for usage based on the configuration of this object\n     *\n     * @private\n     * @param {string} url - The url to prepare.\n     * @return {string} The prepared url.\n     */\n    _prepareUrl(url) {\n        const parsedUrl = parseUri(url, { strictMode: true });\n        let result;\n\n        // absolute url, just use it as is.\n        if (parsedUrl.protocol || !parsedUrl.path || url.indexOf('//') === 0) {\n            result = url;\n        }\n        // if baseUrl doesn't end in slash and url doesn't start with slash, then add a slash inbetween\n        else if (this.baseUrl.length\n            && this.baseUrl.lastIndexOf('/') !== this.baseUrl.length - 1\n            && url.charAt(0) !== '/'\n        ) {\n            result = `${this.baseUrl}/${url}`;\n        }\n        else {\n            result = this.baseUrl + url;\n        }\n\n        // if we need to add a default querystring, there is a bit more work\n        if (this.defaultQueryString) {\n            const hash = rgxExtractUrlHash.exec(result)[0];\n\n            result = result.substr(0, result.length - hash.length);\n\n            if (result.indexOf('?') !== -1) {\n                result += `&${this.defaultQueryString}`;\n            }\n            else {\n                result += `?${this.defaultQueryString}`;\n            }\n\n            result += hash;\n        }\n\n        return result;\n    }\n\n    /**\n     * Loads a single resource.\n     *\n     * @private\n     * @param {Resource} resource - The resource to load.\n     * @param {function} dequeue - The function to call when we need to dequeue this item.\n     */\n    _loadResource(resource, dequeue) {\n        resource._dequeue = dequeue;\n\n        // run before middleware\n        async.eachSeries(\n            this._beforeMiddleware,\n            (fn, next) => {\n                fn.call(this, resource, () => {\n                    // if the before middleware marks the resource as complete,\n                    // break and don't process any more before middleware\n                    next(resource.isComplete ? {} : null);\n                });\n            },\n            () => {\n                if (resource.isComplete) {\n                    this._onLoad(resource);\n                }\n                else {\n                    resource._onLoadBinding = resource.onComplete.once(this._onLoad, this);\n                    resource.load();\n                }\n            },\n            true\n        );\n    }\n\n    /**\n     * Called once loading has started.\n     *\n     * @private\n     */\n    _onStart() {\n        this.progress = 0;\n        this.loading = true;\n        this.onStart.dispatch(this);\n    }\n\n    /**\n     * Called once each resource has loaded.\n     *\n     * @private\n     */\n    _onComplete() {\n        this.progress = MAX_PROGRESS;\n        this.loading = false;\n        this.onComplete.dispatch(this, this.resources);\n    }\n\n    /**\n     * Called each time a resources is loaded.\n     *\n     * @private\n     * @param {Resource} resource - The resource that was loaded\n     */\n    _onLoad(resource) {\n        resource._onLoadBinding = null;\n\n        // remove this resource from the async queue, and add it to our list of resources that are being parsed\n        this._resourcesParsing.push(resource);\n        resource._dequeue();\n\n        // run all the after middleware for this resource\n        async.eachSeries(\n            this._afterMiddleware,\n            (fn, next) => {\n                fn.call(this, resource, next);\n            },\n            () => {\n                resource.onAfterMiddleware.dispatch(resource);\n\n                this.progress = Math.min(MAX_PROGRESS, this.progress + resource.progressChunk);\n                this.onProgress.dispatch(this, resource);\n\n                if (resource.error) {\n                    this.onError.dispatch(resource.error, this, resource);\n                }\n                else {\n                    this.onLoad.dispatch(this, resource);\n                }\n\n                this._resourcesParsing.splice(this._resourcesParsing.indexOf(resource), 1);\n\n                // do completion check\n                if (this._queue.idle() && this._resourcesParsing.length === 0) {\n                    this._onComplete();\n                }\n            },\n            true\n        );\n    }\n}\n\n/**\n * A default array of middleware to run before loading each resource.\n * Each of these middlewares are added to any new Loader instances when they are created.\n *\n * @private\n * @member {function[]}\n */\nLoader._defaultBeforeMiddleware = [];\n\n/**\n * A default array of middleware to run after loading each resource.\n * Each of these middlewares are added to any new Loader instances when they are created.\n *\n * @private\n * @member {function[]}\n */\nLoader._defaultAfterMiddleware = [];\n\n/**\n * Sets up a middleware function that will run *before* the\n * resource is loaded.\n *\n * @static\n * @param {function} fn - The middleware function to register.\n * @return {Loader} Returns itself.\n */\nLoader.pre = function LoaderPreStatic(fn) {\n    Loader._defaultBeforeMiddleware.push(fn);\n\n    return Loader;\n};\n\n/**\n * Sets up a middleware function that will run *after* the\n * resource is loaded.\n *\n * @static\n * @param {function} fn - The middleware function to register.\n * @return {Loader} Returns itself.\n */\nLoader.use = function LoaderUseStatic(fn) {\n    Loader._defaultAfterMiddleware.push(fn);\n\n    return Loader;\n};\n\nexport { Loader };\n\n","import * as async from './async';\nimport * as middleware from './middleware';\nimport { Loader } from './Loader';\nimport { Resource } from './Resource';\nimport { encodeBinary } from './encodeBinary';\n\nObject.defineProperties(Loader, {\n    Resource: { get() {\n        return Resource;\n    } },\n    async: { get() {\n        return async;\n    } },\n    encodeBinary: { get() {\n        return encodeBinary;\n    } },\n    middleware: { get() {\n        return middleware;\n    } },\n});\n\nexport default Loader;\n"],"names":["_noop","eachSeries","array","iterator","callback","deferNext","i","len","length","next","err","setTimeout","onlyOnce","fn","onceWrapper","Error","callFn","apply","arguments","queue","worker","concurrency","workers","q","_tasks","saturated","unsaturated","buffer","empty","drain","error","started","paused","push","data","_insert","kill","unshift","process","task","shift","_next","running","idle","pause","resume","w","insertAtFront","item","cache","caching","resource","url","complete","onComplete","once","parseURI","str","opts","o","key","name","parser","strict","loose","m","strictMode","exec","uri","replace","$0","$1","$2","Object","defineProperty","exports","value","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","MiniSignalBinding","thisArg","undefined","_fn","_once","_thisArg","_prev","_owner","detach","_addMiniSignalBinding","self","node","_head","_tail","MiniSignal","handlers","exists","ee","has","dispatch","add","detachAll","module","useXdr","window","XDomainRequest","XMLHttpRequest","tempAnchor","STATUS_NONE","STATUS_OK","STATUS_EMPTY","STATUS_IE_BUG_EMPTY","STATUS_TYPE_OK","Resource","setExtensionLoadType","extname","loadType","setExtMap","_loadTypeMap","setExtensionXhrType","xhrType","_xhrTypeMap","options","_flags","_setFlag","STATUS_FLAGS","DATA_URL","indexOf","extension","_getExtension","crossOrigin","timeout","_determineLoadType","metadata","xhr","children","type","TYPE","UNKNOWN","progressChunk","_dequeue","_onLoadBinding","_elementTimer","_boundComplete","bind","_boundOnError","_onError","_boundOnProgress","_onProgress","_boundOnTimeout","_onTimeout","_boundXhrOnError","_xhrOnError","_boundXhrOnTimeout","_xhrOnTimeout","_boundXhrOnAbort","_xhrOnAbort","_boundXhrOnLoad","_xhrOnLoad","onStart","Signal","onProgress","onAfterMiddleware","_clearEvents","_finish","abort","message","xdr","src","EMPTY_GIF","firstChild","removeChild","load","cb","isLoading","isComplete","LOADING","_determineCrossOrigin","LOAD_TYPE","IMAGE","_loadElement","AUDIO","_loadSourceElement","VIDEO","XHR","_loadXdr","_loadXhr","_hasFlag","flag","clearTimeout","removeEventListener","onerror","ontimeout","onprogress","onload","COMPLETE","loadElement","Image","document","createElement","skipSource","addEventListener","Audio","navigator","isCocoonJS","Array","isArray","mimeTypes","mimeType","appendChild","_createSource","_determineXhrType","open","XHR_RESPONSE_TYPE","JSON","DOCUMENT","responseType","TEXT","send","mime","source","event","nodeName","lengthComputable","loaded","total","reqType","status","statusText","text","responseText","BUFFER","statusType","parse","e","DOMParser","domparser","parseFromString","div","innerHTML","XML","response","responseURL","loc","origin","location","href","parseUri","samePort","port","protocol","host","hostname","ext","isDataUrl","slashIndex","substring","queryStart","hashStart","index","Math","min","lastIndexOf","toLowerCase","_getMimeFromXhrType","BLOB","DEFAULT","NONE","gif","png","bmp","jpg","jpeg","tif","tiff","webp","tga","svg","mp3","ogg","wav","mp4","webm","xhtml","html","htm","xml","tmx","tsx","json","txt","ttf","otf","map","val","toString","_keyStr","encodeBinary","input","output","inx","bytebuffer","encodedCharIndexes","jnx","charCodeAt","paddingBytes","charAt","Url","URL","webkitURL","parsing","Blob","getResponseHeader","createObjectURL","blob","revokeObjectURL","MAX_PROGRESS","rgxExtractUrlHash","Loader","baseUrl","progress","loading","defaultQueryString","_beforeMiddleware","_afterMiddleware","_resourcesParsing","_boundLoadResource","r","d","_loadResource","_queue","async","resources","onError","onLoad","_defaultBeforeMiddleware","pre","_defaultAfterMiddleware","use","parentResource","_prepareUrl","parent","incompleteChildren","fullChunk","eachChunk","reset","k","res","_onStart","_onComplete","numTasks","chunk","parsedUrl","result","path","hash","substr","dequeue","call","_onLoad","splice","LoaderPreStatic","LoaderUseStatic","get","middleware"],"mappings":"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"}